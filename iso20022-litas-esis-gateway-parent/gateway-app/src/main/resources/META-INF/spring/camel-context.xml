<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camel="http://camel.apache.org/schema/spring"
	xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

	<camel:camelContext xmlns="http://camel.apache.org/schema/spring">
		<camel:route id="handleMokesisFile">
			<camel:from
				uri="file:src/data/outgoing?autoCreate=true&amp;charset=windows-1257&amp;move=.done&amp;moveFailed=.error" />
			<camel:log message="Processing outgoing LITAS payments file (${headers.CamelFileNameOnly}) ..." />
			<camel:unmarshal ref="mokesisFlatpack" />
			<camel:marshal ref="cstmrCdtTrfInitnXML" />
			<camel:convertBodyTo type="java.lang.String" />
			<camel:wireTap uri="file:target/messages" />			
			<camel:setHeader headerName="CamelDestinationOverrideUrl">
				<camel:constant>http://0.0.0.0:8161/AsyncGateway</camel:constant>
			</camel:setHeader>
			<camel:to uri="cxf://http://dummy?dataFormat=PAYLOAD&amp;synchronous=true&amp;wsdlURL=classpath:wsdl/lba-unifi-PaymentsInitiation-Bank-V01.wsdl&amp;defaultOperationName=CustomerCreditTransferInitiationV03" />
			<camel:to uri="file:src/data/outgoing/.stsrpt?fileName=${headers.CamelFileNameOnly}-${date:now:yyyyMMdd}.xml" />
		</camel:route>
	</camel:camelContext>

	<bean id="cstmrCdtTrfInitnXML" class="lt.itdbaltics.unifi.gateway.pain.CustomerCreditTransferDataFormat" />
	
	<bean class="org.apache.camel.component.flatpack.FlatpackDataFormat" id="mokesisFlatpack">
		<property name="definition" value="classpath:MokesisDelimited.pzmap.xml" />
		<property name="delimiter" value="&#x0009;" />
		<property name="ignoreFirstRecord" value="false" />
	</bean>
	
	
</beans>
